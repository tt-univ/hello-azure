<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello WorldをAzureで公開する手順</title>
    
    <style>
        body {
            font-family: 'Segoe UI', Meiryo, system-ui, sans-serif;
            line-height: 1.8;
            background-color: #f8f9fa;
            color: #343a40;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 90%;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
        }
        header {
            background-color: #0078d4;
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        header h1 { margin: 0; font-size: 2.2rem; }
        
        main {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        section { margin-bottom: 2.5rem; border-bottom: 1px solid #eee; padding-bottom: 1.5rem; }
        section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0;}
        
        h2 {
            font-size: 1.8rem;
            color: #0078d4;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        h3 {
            font-size: 1.3rem;
            color: #495057;
            border-left: 4px solid #0078d4;
            padding-left: 0.8rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        
        ul, ol { padding-left: 25px; }
        li { margin-bottom: 0.8rem; }
        
        code {
            background-color: #e9ecef;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: Consolas, Monaco, monospace;
            font-size: 0.9em;
            color: #333;
        }
        pre code {
            display: block;
            padding: 1rem;
            background-color: #343a40;
            color: #f8f9fa;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        a { color: #0056b3; text-decoration: none; }
        a:hover { text-decoration: underline; }
        
        .text-description { /* テキスト説明用 */
            border: 1px solid #ced4da;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin: 1rem 0;
            color: #495057;
            font-size: 0.95rem;
        }
        .text-description strong { color: #0056b3;}
        
        .important {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }
        .important strong { color: #856404; }

        footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* --- ここからコピーボタン用CSS --- */
        .code-block-header {
            background-color: #e9ecef; /* コード背景より少し明るく */
            padding: 5px 10px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            text-align: right; /* ボタンを右寄せ */
            border: 1px solid #ced4da;
            border-bottom: none; /* 下線はpreに任せる */
        }
        .copy-btn {
            background-color: #6c757d; /* グレー系 */
            color: white;
            border: none;
            padding: 3px 8px;
            font-size: 0.8em;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-btn:hover {
            background-color: #495057; /* 濃いグレー */
        }
        /* preタグの上マージンを調整 */
        pre {
            margin-top: 0 !important; /* ヘッダーと隙間なく繋げる */
            border-top-left-radius: 0; /* 角丸をなくす */
            border-top-right-radius: 0;
        }
        /* --- ここまでコピーボタン用CSS --- */

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Hello WorldをAzureで公開する手順</h1>
        </header>

        <main>
            <section id="step1">
                <h2>1. PCで準備 💻</h2>
                <h3>1-1. フォルダ作成 & VS Code起動</h3>
                <p>WSL (Ubuntu) ターミナルで実行:</p>
                <div class="code-block-header"><button class="copy-btn">コピー</button></div>
                <pre><code class="language-bash">
cd ~ 
mkdir hello-azure 
cd hello-azure
code .
                </code></pre>
                <div class="text-description">
                    <strong>【画面説明】</strong> ターミナルにコマンドが入力され、新しいフォルダが作成され、最後に `code .` でVS Codeが起動するはずです。VS Codeのウィンドウが開いたらOK。
                </div>
                
                <h3>1-2. index.html 作成 & コード記述</h3>
                <p>VS Codeの左側にあるエクスプローラー（ファイル一覧）で右クリックし、「新しいファイル」を選び `index.html` という名前でファイルを作成します。</p>
                <p>作成した `index.html` に以下のコードを貼り付け、保存 (Ctrl+S) します。</p>
                <div class="code-block-header"><button class="copy-btn">コピー</button></div>
                <pre><code class="language-html">
&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Hello Azure!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Hello World from Azure!&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
                </code></pre>
                <div class="text-description">
                    <strong>【画面説明】</strong> VS Codeのエディタ部分に上記のHTMLコードが表示され、ファイルタブの `index.html` の横にある白い丸(●)が消えていれば保存完了です。
                </div>

                <h3>1-3. Git初期化 & コミット</h3>
                <p>VS Codeの下部にあるターミナルパネルで実行します。</p>
                <div class="code-block-header"><button class="copy-btn">コピー</button></div>
                <pre><code class="language-bash">
git init
git add .
git commit -m "Initial Hello World page"
                 </code></pre>
                 <div class="text-description">
                    <strong>【画面説明】</strong> 各コマンドが実行され、最後に `[main (root-commit) ...] Initial Hello World page` のようなコミット成功メッセージが表示されればOK。
                </div>
            </section>
            
            <section id="step2">
                 <h2>2. GitHubに保管場所を作る 🐙</h2>
                 <p>ブラウザで<a href="https://github.com/" target="_blank">GitHub</a> (任意のアカウント) にアクセスし、右上の「＋」アイコンから「**New repository**」を選びます。</p>
                 <p>次の画面で、「**Repository name**」に `hello-azure` と入力し、「**Public**」が選択されていることを確認します。**「Add a README file」などのチェックボックスは全てオフのまま**、緑色の「**Create repository**」ボタンをクリックします。</p>
                 <div class="text-description">
                     <strong>【画面説明】</strong> 空のリポジトリのページ（Quick setup という表示があるページ）が表示されれば成功です。このページに表示されているHTTPSのURLを後で使います。
                 </div>
            </section>

            <section id="step3">
                 <h2>3. GitHubへアップロード 🚀</h2>
                 <h3>3-1. 接続先を設定</h3>
                 <p>VS Codeのターミナルで実行します。[リポジトリURL]はGitHubでコピーしたものに置き換えます。</p>
                 <div class="code-block-header"><button class="copy-btn">コピー</button></div>
                 <pre><code class="language-bash">
git remote add origin https://tt-univ@[リポジトリURLのgithub.com以降]
git branch -M main
                 </code></pre>
                 
                 <h3>3-2. プッシュ！</h3>
                 <div class="code-block-header"><button class="copy-btn">コピー</button></div>
                 <pre><code class="language-bash">git push -u origin main</code></pre>
                 <div class="important">
                     <strong>【重要】認証</strong><br>
                     Passwordを聞かれたら、任意のアカウントの<strong>パーソナルアクセストークン(PAT)</strong> (`repo`+`workflow`権限) を貼り付けます。（画面には何も表示されませんが入力されています）
                 </div>
                 <div class="text-description">
                     <strong>【画面説明】</strong> `Enumerating objects... done.` などが表示され、最後に `Branch 'main' set up to track remote branch 'main' from 'origin'.` と表示されればプッシュ成功です。
                 </div>
            </section>
            
            <section id="step4">
                <h2>4. Azureで公開場所を作る ☁️</h2>
                <h3>4-1. Static Web Apps 作成</h3>
                <p><a href="https://portal.azure.com/" target="_blank">Azure Portal</a>で「静的 Web アプリ」を検索し「作成」。</p>
                
                <h3>4-2. 基本設定</h3>
                <ul>
                    <li>サブスクリプション: Azure for Students などを選択</li>
                    <li>リソースグループ: 「新規作成」をクリックし、`hello-azure-rg` と入力してOK。</li>
                    <li>名前: `hello-azure-app-name` など、世界でユニークな名前を入力。</li>
                    <li>ホスティングプラン: **Free** を選択。</li>
                    <li>リージョン: **EastAsia** を選択。</li>
                </ul>
                <div class="text-description">
                    <strong>【画面説明】</strong> 上記の項目を入力・選択します。名前が他の人と被るとエラーになるので注意。
                </div>

                <h3>4-3. デプロイ設定</h3>
                <ul>
                    <li>ソース: **GitHub** を選択し、「GitHubアカウントでサインイン」ボタンを押し、**任意のアカウント**で認証・連携を許可します。</li>
                    <li>組織: ドロップダウンから `任意のアカウント名` を選択。</li>
                    <li>リポジトリ: ドロップダウンから `hello-azure` を選択。</li>
                    <li>分岐: ドロップダウンから `main` を選択。</li>
                </ul>
                 <div class="text-description">
                     <strong>【画面説明】</strong> GitHubアカウント連携後、リポジトリと分岐が正しく選択されていることを確認します。
                 </div>
                 
                <h3>4-4. ビルド設定</h3>
                <ul>
                     <li>ビルドのプリセット: ドロップダウンから **カスタム** を選択。</li>
                     <li>アプリの場所: `/` と入力。（最初から入っているかも）</li>
                     <li>APIの場所: **空欄**のまま。</li>
                     <li>出力先: **空欄**のまま。</li>
                </ul>
                
                <h3>4-5. 作成</h3>
                <p>「**確認および作成**」ボタンを押し、内容を確認したら「**作成**」ボタンをクリックします。</p>
                 <div class="text-description">
                     <strong>【画面説明】</strong> 「デプロイが進行中です」と表示され、しばらく待つと「デプロイが完了しました」に変わります。
                 </div>
            </section>

             <section id="step5">
                <h2>5. 【重要】「鍵」の修正 🔑</h2>
                <p>AzureとGitHubの接続設定（デプロイトークン）が自動で正しく行われない場合があるので、手動で確認・修正します。</p>
                <h3>5-1. Azureから「本物の鍵」取得</h3>
                <p>Azure PortalでCloud Shellを開き、以下のコマンドを実行 ([アプリ名], [RG名]は自分のものに):</p>
                 <div class="code-block-header"><button class="copy-btn">コピー</button></div>
                <pre><code class="language-bash">az staticwebapp secrets list --name [アプリ名] --resource-group [RG名]</code></pre>
                <p>`apiKey`の値をコピーします。</p>
                <div class="text-description">
                    <strong>【画面説明】</strong> Cloud Shellに `{"apiKey": "長い文字列..."}` のようなJSONが表示されます。`apiKey`の値を正確にコピーします。
                </div>

                <h3>5-2. GitHubから「正しい鍵の名前」取得</h3>
                <p>VS Codeターミナルで `git pull origin main` を実行してAzureが自動生成したファイルを取得します。その後、エクスプローラーで `.github/workflows/` フォルダ内のYAMLファイルを開きます。</p>
                <p>ファイルの中にある `azure_static_web_apps_api_token:` の行を探し、`secrets.` の後ろにある `AZURE_STATIC_WEB_APPS_API_TOKEN_...` という**非常に長い名前**をコピーします。</p>
                <div class="text-description">
                    <strong>【画面説明】</strong> VS CodeでYAMLファイルが開き、指定された行の `secrets.` の後の長い名前を確認し、コピーします。
                </div>
                
                <h3>5-3. GitHub Secretsに設定</h3>
                <p>GitHubの `hello-azure` リポジトリページの「**Settings**」→「**Secrets and variables**」→「**Actions**」を開きます。</p>
                <p>既存の `AZURE_STATIC_WEB_APPS_API_TOKEN_...` というSecretがあれば、右のゴミ箱アイコンで**削除**します。</p>
                <p>「**New repository secret**」ボタンをクリックし、以下を設定:</p>
                <ul>
                    <li><strong>Name:</strong> 5-2でコピーした「正しい鍵の名前」を貼り付け</li>
                    <li><strong>Value:</strong> 5-1でコピーした「本物の鍵」を貼り付け</li>
                </ul>
                <p>「**Add secret**」ボタンで保存します。</p>
                 <div class="text-description">
                     <strong>【画面説明】</strong> GitHubのSecrets設定画面で、正しい名前と値で新しいSecretが登録されていることを確認します。
                 </div>
            </section>

            <section id="step6">
                <h2>6. 最後の確認 ✅</h2>
                <p>GitHubリポジトリの「**Actions**」タブを開きます。一番上のワークフロー実行が失敗(❌)していた場合は、右側にある**再実行ボタン(🔄)** をクリックし、「Re-run failed jobs」を選びます。</p>
                <p>ワークフローが成功(✅)するのを待ちます（数分かかります）。</p>
                <div class="text-description">
                    <strong>【画面説明】</strong> GitHub Actionsの最新の実行結果が緑のチェックマーク✅になればOK。
                </div>
                <p>成功したら、Azure Portalで静的Webアプリの「概要」ページに戻り、「**URL**」と書かれたリンクをクリックします。</p>
                <p>ブラウザで "Hello World from Azure!" と表示されれば、**無事にWebサイトの公開が完了です！** 🎉</p>
                 <div class="text-description">
                     <strong>【画面説明】</strong> ブラウザに白い背景で「Hello World from Azure!」という黒い文字が表示されます。
                 </div>
            </section>
            
        </main>

        <footer>
            <p>&copy; 2025 TT-UNIV</p>
            <p><a href="https://github.com/tt-univ/hello-azure" target="_blank">[このサイトのGitHubリポジトリ (hello-azure)]</a></p>
        </footer>
    </div>

    <script>
        const copyButtons = document.querySelectorAll('.copy-btn');
        copyButtons.forEach(button => {
            button.addEventListener('click', () => {
                const preElement = button.parentElement.nextElementSibling;
                const codeElement = preElement ? preElement.querySelector('code') : null;
                if (codeElement) {
                    const codeToCopy = codeElement.innerText;
                    navigator.clipboard.writeText(codeToCopy).then(() => {
                        const originalText = button.innerText;
                        button.innerText = 'コピー完了!';
                        button.disabled = true;
                        setTimeout(() => {
                            button.innerText = originalText;
                            button.disabled = false;
                        }, 1500);
                    }).catch(err => {
                        console.error('コピーに失敗:', err);
                        alert('コピーに失敗しました。');
                    });
                } else { console.error('コードブロックが見つかりません。'); }
            });
        });
    </script>
    </body>
</html>